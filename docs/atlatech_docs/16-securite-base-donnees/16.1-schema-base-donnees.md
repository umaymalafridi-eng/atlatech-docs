---
title: Schéma Base de Données
sidebar_label: "16.1 Schéma Base de Données"
sidebar_position: 2
---

# 16.1 Schéma Base de Données

## Introduction

Le schéma de base de données définit la structure des tables, leurs relations et l'organisation logique des données. Pour AtlasTech Solutions, nous avons deux ensembles de tables distincts : le **Site Web Commercial** et l'**Application CRUD RH**.

### Qu'est-ce qu'un schéma de base de données ?

**Pour les non-techniciens :** Imaginez un schéma comme le plan architectural d'une bibliothèque. Il définit combien d'étagères vous avez, comment elles sont organisées, et quels types de livres vont où. Dans une base de données, le schéma définit quelles informations sont stockées et comment elles sont liées.

**Pour les techniciens :** Le schéma définit la structure logique des tables (colonnes, types de données, contraintes) et les relations entre elles (clés primaires, clés étrangères, indexes).

---

## 16.1.1 Tables du Site Web Commercial

### Vue d'ensemble

Le site web commercial gère le catalogue de produits, les commandes et les informations clients.

```
┌─────────────────────────────────────────────────┐
│            Site Web Commercial                  │
├─────────────────────────────────────────────────┤
│                                                 │
│   ┌──────────┐                                  │
│   │ CLIENTS  │◄──────┐                          │
│   └────┬─────┘       │                          │
│        │             │                          │
│        │ commandes   │                          │
│        ▼             │                          │
│   ┌──────────┐       │                          │
│   │COMMANDES │       │ client_id                │
│   └────┬─────┘       │                          │
│        │             │                          │
│        │ lignes      │                          │
│        ▼             │                          │
│   ┌───────────────┐  │                          │
│   │DETAILS_COMMANDE──┘                          │
│   └───────┬───────┘                             │
│           │                                     │
│           │ produit_id                          │
│           ▼                                     │
│   ┌──────────┐                                  │
│   │ PRODUITS │                                  │
│   └──────────┘                                  │
└─────────────────────────────────────────────────┘
```

### Table : clients

**Description :** Stocke les informations des clients du site web.

```sql
CREATE TABLE clients (
    client_id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    prenom VARCHAR(100) NOT NULL,
    email VARCHAR(150) NOT NULL UNIQUE,
    telephone VARCHAR(20),
    adresse TEXT,
    ville VARCHAR(100),
    code_postal VARCHAR(10),
    pays VARCHAR(50) DEFAULT 'Maroc',
    date_inscription DATETIME DEFAULT CURRENT_TIMESTAMP,
    actif BOOLEAN DEFAULT TRUE,
    
    INDEX idx_email (email),
    INDEX idx_nom_prenom (nom, prenom)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Colonnes importantes :**

| Colonne | Type | Description |
|---------|------|-------------|
| client_id | INT | Identifiant unique (clé primaire) |
| email | VARCHAR(150) | Email unique pour connexion |
| actif | BOOLEAN | Permet de désactiver un compte sans le supprimer |

**Insertion de données de test :**

```sql
INSERT INTO clients (nom, prenom, email, telephone, ville) VALUES
('Benjelloun', 'Karim', 'k.benjelloun@example.ma', '0612345678', 'Casablanca'),
('Alami', 'Fatima', 'f.alami@example.ma', '0623456789', 'Rabat'),
('Tazi', 'Mohammed', 'm.tazi@example.ma', '0634567890', 'Marrakech');
```

### Table : produits

**Description :** Catalogue des produits vendus sur le site web.

```sql
CREATE TABLE produits (
    produit_id INT AUTO_INCREMENT PRIMARY KEY,
    nom_produit VARCHAR(200) NOT NULL,
    description TEXT,
    prix_unitaire DECIMAL(10,2) NOT NULL,
    stock_disponible INT DEFAULT 0,
    categorie ENUM('Site Vitrine', 'E-commerce', 'Application Mobile', 'Maintenance') NOT NULL,
    actif BOOLEAN DEFAULT TRUE,
    date_creation DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_categorie (categorie),
    INDEX idx_prix (prix_unitaire),
    
    CONSTRAINT chk_prix_positif CHECK (prix_unitaire > 0),
    CONSTRAINT chk_stock_positif CHECK (stock_disponible >= 0)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Insertion de données de test :**

```sql
INSERT INTO produits (nom_produit, description, prix_unitaire, stock_disponible, categorie) VALUES
('Pack Site Vitrine Basic', 'Site vitrine 5 pages avec design moderne', 5000.00, 100, 'Site Vitrine'),
('Pack E-commerce Standard', 'Boutique en ligne complète avec paiement', 15000.00, 50, 'E-commerce'),
('Application Mobile Android', 'Application mobile native Android', 25000.00, 20, 'Application Mobile'),
('Maintenance Mensuelle', 'Maintenance et mises à jour mensuelles', 500.00, 999, 'Maintenance');
```

### Table : commandes

**Description :** Enregistre les commandes passées par les clients.

```sql
CREATE TABLE commandes (
    commande_id INT AUTO_INCREMENT PRIMARY KEY,
    client_id INT NOT NULL,
    date_commande DATETIME DEFAULT CURRENT_TIMESTAMP,
    statut ENUM('En attente', 'Confirmée', 'En cours', 'Livrée', 'Annulée') DEFAULT 'En attente',
    montant_total DECIMAL(10,2) NOT NULL,
    mode_paiement ENUM('Carte bancaire', 'Virement', 'Espèces', 'Chèque'),
    notes TEXT,
    
    FOREIGN KEY (client_id) REFERENCES clients(client_id) ON DELETE RESTRICT,
    INDEX idx_statut (statut),
    INDEX idx_date (date_commande)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Explication de la Foreign Key :**

```sql
FOREIGN KEY (client_id) REFERENCES clients(client_id) ON DELETE RESTRICT
```

- `FOREIGN KEY (client_id)` : La colonne client_id dans cette table
- `REFERENCES clients(client_id)` : Fait référence à client_id dans la table clients
- `ON DELETE RESTRICT` : Empêche la suppression d'un client s'il a des commandes

**Insertion de données de test :**

```sql
INSERT INTO commandes (client_id, statut, montant_total, mode_paiement) VALUES
(1, 'Confirmée', 5000.00, 'Virement'),
(2, 'En cours', 15000.00, 'Carte bancaire'),
(1, 'Livrée', 500.00, 'Carte bancaire');
```

### Table : details_commande

**Description :** Détails des produits dans chaque commande (table de liaison).

```sql
CREATE TABLE details_commande (
    detail_id INT AUTO_INCREMENT PRIMARY KEY,
    commande_id INT NOT NULL,
    produit_id INT NOT NULL,
    quantite INT NOT NULL DEFAULT 1,
    prix_unitaire DECIMAL(10,2) NOT NULL,
    
    FOREIGN KEY (commande_id) REFERENCES commandes(commande_id) ON DELETE CASCADE,
    FOREIGN KEY (produit_id) REFERENCES produits(produit_id) ON DELETE RESTRICT,
    
    CONSTRAINT chk_quantite_positive CHECK (quantite > 0)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Pourquoi ON DELETE CASCADE ici ?**

Si une commande est supprimée, ses détails doivent l'être aussi (ils n'ont pas de sens sans la commande).

**Insertion de données de test :**

```sql
INSERT INTO details_commande (commande_id, produit_id, quantite, prix_unitaire) VALUES
(1, 1, 1, 5000.00),
(2, 2, 1, 15000.00),
(3, 4, 1, 500.00);
```

---

## 16.1.2 Tables de l'Application CRUD RH

### Vue d'ensemble

L'application RH gère les employés, départements, congés et salaires.

```
┌─────────────────────────────────────────────────┐
│           Application CRUD RH                   │
├─────────────────────────────────────────────────┤
│                                                 │
│   ┌──────────────┐                              │
│   │ DEPARTEMENTS │◄─────┐                       │
│   └──────────────┘      │                       │
│                         │                       │
│                         │ departement_id        │
│   ┌──────────┐          │                       │
│   │ EMPLOYES │──────────┘                       │
│   └────┬─────┘                                  │
│        │                                        │
│        ├──────► ┌─────────┐                     │
│        │        │ CONGES  │                     │
│        │        └─────────┘                     │
│        │                                        │
│        └──────► ┌──────────┐                    │
│                 │ SALAIRES │                    │
│                 └──────────┘                    │
└─────────────────────────────────────────────────┘
```

### Table : departements

**Description :** Liste des départements de l'entreprise.

```sql
CREATE TABLE departements (
    departement_id INT AUTO_INCREMENT PRIMARY KEY,
    nom_departement VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    responsable_id INT NULL,
    budget_annuel DECIMAL(12,2),
    actif BOOLEAN DEFAULT TRUE,
    
    INDEX idx_nom (nom_departement)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Insertion de données de test :**

```sql
INSERT INTO departements (nom_departement, description, budget_annuel) VALUES
('Direction Générale', 'Direction et management général', 500000.00),
('Informatique', 'Administration systèmes et réseaux', 300000.00),
('Développement', 'Développement et maintenance applicative', 400000.00),
('Ressources Humaines', 'Gestion du personnel', 200000.00),
('Finance', 'Gestion financière et facturation', 250000.00),
('Commercial', 'Gestion clients et activités commerciales', 350000.00);
```

### Table : employes

**Description :** Informations complètes des employés (version sécurisée).

```sql
CREATE TABLE employes (
    employe_id INT AUTO_INCREMENT PRIMARY KEY,
    utilisateur VARCHAR(50) NOT NULL UNIQUE,
    mot_de_passe VARCHAR(255) NOT NULL,
    prenom VARCHAR(100) NOT NULL,
    nom VARCHAR(100) NOT NULL,
    email VARCHAR(150) NOT NULL UNIQUE,
    telephone_crypte VARBINARY(256),
    departement_id INT NOT NULL,
    poste VARCHAR(100),
    type_contrat ENUM('CDI', 'CDD', 'Stage', 'Alternance') NOT NULL,
    date_embauche DATE NOT NULL,
    date_fin_contrat DATE NULL,
    cin VARCHAR(20) UNIQUE,
    numero_cnops VARCHAR(13),
    statut_cnops ENUM('Adherent', 'Non adherent', 'En attente') DEFAULT 'En attente',
    is_admin BOOLEAN DEFAULT FALSE,
    must_change_password BOOLEAN DEFAULT TRUE,
    actif BOOLEAN DEFAULT TRUE,
    
    FOREIGN KEY (departement_id) REFERENCES departements(departement_id) ON DELETE RESTRICT,
    
    INDEX idx_email (email),
    INDEX idx_nom_prenom (nom, prenom),
    INDEX idx_departement (departement_id),
    
    CONSTRAINT chk_date_embauche CHECK (date_embauche <= CURDATE())
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Changements par rapport à la version vulnérable :**

| Avant | Après | Raison |
|-------|-------|--------|
| `departement VARCHAR(50)` | `departement_id INT + FK` | Intégrité référentielle |
| `telephone VARCHAR(20)` | `telephone_crypte VARBINARY(256)` | Chiffrement AES-256 |
| `type_contrat VARCHAR(20)` | `ENUM('CDI', 'CDD', ...)` | Validation des valeurs |
| `is_admin VARCHAR(10)` | `BOOLEAN` | Type approprié |

**Insertion de données de test :**

```sql
INSERT INTO employes (utilisateur, mot_de_passe, prenom, nom, email, departement_id, poste, type_contrat, date_embauche, is_admin) VALUES
('a.haidar', '$argon2id$v=19$m=65536,t=4$...', 'Abdelaziz', 'Haidar', 'a.haidar@company.ma', 1, 'Directeur Général', 'CDI', '2020-01-15', TRUE),
('oumayma.l', '$argon2id$v=19$m=65536,t=4$...', 'Oumayma', 'Lafridi', 'o.lafridi@company.ma', 2, 'Admin Systèmes', 'CDI', '2021-03-10', FALSE),
('ibtissam.g', '$argon2id$v=19$m=65536,t=4$...', 'Ibtissam', 'Elghbali', 'i.elghbali@company.ma', 2, 'Responsable Réseaux', 'CDI', '2021-06-01', FALSE);
```

### Table : conges

**Description :** Gestion des congés des employés.

```sql
CREATE TABLE conges (
    conge_id INT AUTO_INCREMENT PRIMARY KEY,
    employe_id INT NOT NULL,
    type_conge ENUM('Congé payé', 'Congé maladie', 'Congé sans solde', 'Formation') NOT NULL,
    date_debut DATE NOT NULL,
    date_fin DATE NOT NULL,
    nombre_jours INT GENERATED ALWAYS AS (DATEDIFF(date_fin, date_debut) + 1) STORED,
    statut ENUM('En attente', 'Approuvé', 'Refusé', 'Annulé') DEFAULT 'En attente',
    motif TEXT,
    approuve_par INT NULL,
    date_approbation DATETIME NULL,
    
    FOREIGN KEY (employe_id) REFERENCES employes(employe_id) ON DELETE CASCADE,
    FOREIGN KEY (approuve_par) REFERENCES employes(employe_id) ON DELETE SET NULL,
    
    INDEX idx_employe (employe_id),
    INDEX idx_statut (statut),
    INDEX idx_dates (date_debut, date_fin),
    
    CONSTRAINT chk_dates_coherentes CHECK (date_fin >= date_debut),
    CONSTRAINT chk_dates_futures CHECK (date_debut >= CURDATE())
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Colonne calculée automatiquement :**

```sql
nombre_jours INT GENERATED ALWAYS AS (DATEDIFF(date_fin, date_debut) + 1) STORED
```

Cette colonne se calcule automatiquement et ne peut pas être modifiée manuellement.

**Insertion de données de test :**

```sql
INSERT INTO conges (employe_id, type_conge, date_debut, date_fin, statut, approuve_par) VALUES
(2, 'Congé payé', '2026-03-01', '2026-03-07', 'Approuvé', 1),
(3, 'Formation', '2026-04-15', '2026-04-17', 'En attente', NULL);
```

### Table : salaires

**Description :** Historique des salaires (données sensibles chiffrées).

```sql
CREATE TABLE salaires (
    salaire_id INT AUTO_INCREMENT PRIMARY KEY,
    employe_id INT NOT NULL,
    salaire_base_crypte VARBINARY(256) NOT NULL,
    primes_cryptees VARBINARY(256),
    date_effet DATE NOT NULL,
    devise CHAR(3) DEFAULT 'MAD',
    commentaire_crypte VARBINARY(512),
    
    FOREIGN KEY (employe_id) REFERENCES employes(employe_id) ON DELETE CASCADE,
    
    INDEX idx_employe (employe_id),
    INDEX idx_date (date_effet)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**Pourquoi VARBINARY au lieu de DECIMAL ?**

Les salaires sont chiffrés avec AES-256, produisant des données binaires impossibles à stocker en DECIMAL.

---

## 16.1.3 Vérification du schéma

### Lister toutes les tables

```sql
USE atlastech_db;
SHOW TABLES;
```

**Résultat attendu :**

```
+-------------------------+
| Tables_in_atlastech_db |
+-------------------------+
| clients                 |
| commandes               |
| conges                  |
| departements            |
| details_commande        |
| employes                |
| produits                |
| salaires                |
+-------------------------+
8 rows in set (0.001 sec)
```

### Visualiser la structure d'une table

```sql
DESCRIBE employes;
```

**Résultat :**

| Field | Type | Null | Key | Default | Extra |
|-------|------|------|-----|---------|-------|
| employe_id | int(11) | NO | PRI | NULL | auto_increment |
| utilisateur | varchar(50) | NO | UNI | NULL | |
| mot_de_passe | varchar(255) | NO | | NULL | |
| departement_id | int(11) | NO | MUL | NULL | |
| ... | ... | ... | ... | ... | ... |

### Vérifier les Foreign Keys

```sql
SELECT 
    TABLE_NAME,
    COLUMN_NAME,
    CONSTRAINT_NAME,
    REFERENCED_TABLE_NAME,
    REFERENCED_COLUMN_NAME
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE
WHERE TABLE_SCHEMA = 'atlastech_db'
  AND REFERENCED_TABLE_NAME IS NOT NULL;
```

**Résultat attendu :**

| TABLE_NAME | COLUMN_NAME | REFERENCED_TABLE_NAME | REFERENCED_COLUMN_NAME |
|------------|-------------|-----------------------|------------------------|
| commandes | client_id | clients | client_id |
| details_commande | commande_id | commandes | commande_id |
| details_commande | produit_id | produits | produit_id |
| employes | departement_id | departements | departement_id |
| conges | employe_id | employes | employe_id |
| salaires | employe_id | employes | employe_id |

---

## 16.1.4 Diagramme Entité-Association (ERD)

### Schéma complet des relations

```
SITE WEB COMMERCIAL:

┌──────────┐          ┌─────────────┐         ┌──────────┐
│ CLIENTS  │ 1     N  │  COMMANDES  │ 1    N  │DETAILS   │
│          │◄─────────┤             ├────────►│COMMANDE  │
└──────────┘          └─────────────┘         └────┬─────┘
                                                    │
                                                    │ N
                                                    │
                                                    │ 1
                                              ┌─────▼────┐
                                              │ PRODUITS │
                                              └──────────┘

APPLICATION RH:

┌──────────────┐
│ DEPARTEMENTS │
└──────┬───────┘
       │ 1
       │
       │ N
┌──────▼────┐       ┌─────────┐       ┌──────────┐
│ EMPLOYES  ├──────►│ CONGES  │       │ SALAIRES │
│           │ 1   N └─────────┘       └──────────┘
└───────────┴──────────────────────────────┘
     1   N
```

### Script de génération complet

**Fichier : `create_schema.sql`**

```sql
-- =====================================================
-- Script de création du schéma AtlasTech Solutions
-- Version sécurisée avec Foreign Keys et contraintes
-- =====================================================

DROP DATABASE IF EXISTS atlastech_db;
CREATE DATABASE atlastech_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE atlastech_db;

-- =====================================================
-- SITE WEB COMMERCIAL
-- =====================================================

-- Table: clients
CREATE TABLE clients (
    client_id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    prenom VARCHAR(100) NOT NULL,
    email VARCHAR(150) NOT NULL UNIQUE,
    telephone VARCHAR(20),
    adresse TEXT,
    ville VARCHAR(100),
    code_postal VARCHAR(10),
    pays VARCHAR(50) DEFAULT 'Maroc',
    date_inscription DATETIME DEFAULT CURRENT_TIMESTAMP,
    actif BOOLEAN DEFAULT TRUE,
    INDEX idx_email (email),
    INDEX idx_nom_prenom (nom, prenom)
) ENGINE=InnoDB;

-- Table: produits
CREATE TABLE produits (
    produit_id INT AUTO_INCREMENT PRIMARY KEY,
    nom_produit VARCHAR(200) NOT NULL,
    description TEXT,
    prix_unitaire DECIMAL(10,2) NOT NULL,
    stock_disponible INT DEFAULT 0,
    categorie ENUM('Site Vitrine', 'E-commerce', 'Application Mobile', 'Maintenance') NOT NULL,
    actif BOOLEAN DEFAULT TRUE,
    date_creation DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_categorie (categorie),
    INDEX idx_prix (prix_unitaire),
    CONSTRAINT chk_prix_positif CHECK (prix_unitaire > 0),
    CONSTRAINT chk_stock_positif CHECK (stock_disponible >= 0)
) ENGINE=InnoDB;

-- Table: commandes
CREATE TABLE commandes (
    commande_id INT AUTO_INCREMENT PRIMARY KEY,
    client_id INT NOT NULL,
    date_commande DATETIME DEFAULT CURRENT_TIMESTAMP,
    statut ENUM('En attente', 'Confirmée', 'En cours', 'Livrée', 'Annulée') DEFAULT 'En attente',
    montant_total DECIMAL(10,2) NOT NULL,
    mode_paiement ENUM('Carte bancaire', 'Virement', 'Espèces', 'Chèque'),
    notes TEXT,
    FOREIGN KEY (client_id) REFERENCES clients(client_id) ON DELETE RESTRICT,
    INDEX idx_statut (statut),
    INDEX idx_date (date_commande)
) ENGINE=InnoDB;

-- Table: details_commande
CREATE TABLE details_commande (
    detail_id INT AUTO_INCREMENT PRIMARY KEY,
    commande_id INT NOT NULL,
    produit_id INT NOT NULL,
    quantite INT NOT NULL DEFAULT 1,
    prix_unitaire DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (commande_id) REFERENCES commandes(commande_id) ON DELETE CASCADE,
    FOREIGN KEY (produit_id) REFERENCES produits(produit_id) ON DELETE RESTRICT,
    CONSTRAINT chk_quantite_positive CHECK (quantite > 0)
) ENGINE=InnoDB;

-- =====================================================
-- APPLICATION CRUD RH
-- =====================================================

-- Table: departements
CREATE TABLE departements (
    departement_id INT AUTO_INCREMENT PRIMARY KEY,
    nom_departement VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    responsable_id INT NULL,
    budget_annuel DECIMAL(12,2),
    actif BOOLEAN DEFAULT TRUE,
    INDEX idx_nom (nom_departement)
) ENGINE=InnoDB;

-- Table: employes
CREATE TABLE employes (
    employe_id INT AUTO_INCREMENT PRIMARY KEY,
    utilisateur VARCHAR(50) NOT NULL UNIQUE,
    mot_de_passe VARCHAR(255) NOT NULL,
    prenom VARCHAR(100) NOT NULL,
    nom VARCHAR(100) NOT NULL,
    email VARCHAR(150) NOT NULL UNIQUE,
    telephone_crypte VARBINARY(256),
    departement_id INT NOT NULL,
    poste VARCHAR(100),
    type_contrat ENUM('CDI', 'CDD', 'Stage', 'Alternance') NOT NULL,
    date_embauche DATE NOT NULL,
    date_fin_contrat DATE NULL,
    cin VARCHAR(20) UNIQUE,
    numero_cnops VARCHAR(13),
    statut_cnops ENUM('Adherent', 'Non adherent', 'En attente') DEFAULT 'En attente',
    is_admin BOOLEAN DEFAULT FALSE,
    must_change_password BOOLEAN DEFAULT TRUE,
    actif BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (departement_id) REFERENCES departements(departement_id) ON DELETE RESTRICT,
    INDEX idx_email (email),
    INDEX idx_nom_prenom (nom, prenom),
    INDEX idx_departement (departement_id),
    CONSTRAINT chk_date_embauche CHECK (date_embauche <= CURDATE())
) ENGINE=InnoDB;

-- Table: conges
CREATE TABLE conges (
    conge_id INT AUTO_INCREMENT PRIMARY KEY,
    employe_id INT NOT NULL,
    type_conge ENUM('Congé payé', 'Congé maladie', 'Congé sans solde', 'Formation') NOT NULL,
    date_debut DATE NOT NULL,
    date_fin DATE NOT NULL,
    nombre_jours INT GENERATED ALWAYS AS (DATEDIFF(date_fin, date_debut) + 1) STORED,
    statut ENUM('En attente', 'Approuvé', 'Refusé', 'Annulé') DEFAULT 'En attente',
    motif TEXT,
    approuve_par INT NULL,
    date_approbation DATETIME NULL,
    FOREIGN KEY (employe_id) REFERENCES employes(employe_id) ON DELETE CASCADE,
    FOREIGN KEY (approuve_par) REFERENCES employes(employe_id) ON DELETE SET NULL,
    INDEX idx_employe (employe_id),
    INDEX idx_statut (statut),
    INDEX idx_dates (date_debut, date_fin),
    CONSTRAINT chk_dates_coherentes CHECK (date_fin >= date_debut)
) ENGINE=InnoDB;

-- Table: salaires
CREATE TABLE salaires (
    salaire_id INT AUTO_INCREMENT PRIMARY KEY,
    employe_id INT NOT NULL,
    salaire_base_crypte VARBINARY(256) NOT NULL,
    primes_cryptees VARBINARY(256),
    date_effet DATE NOT NULL,
    devise CHAR(3) DEFAULT 'MAD',
    commentaire_crypte VARBINARY(512),
    FOREIGN KEY (employe_id) REFERENCES employes(employe_id) ON DELETE CASCADE,
    INDEX idx_employe (employe_id),
    INDEX idx_date (date_effet)
) ENGINE=InnoDB;
```

**Exécution du script :**

```bash
mysql -u root -p < create_schema.sql
```

---

## Conclusion

Le schéma de base de données sécurisé d'AtlasTech Solutions intègre :

- **8 tables** organisées en 2 applications distinctes
- **Foreign Keys** garantissant l'intégrité référentielle
- **Types de données appropriés** (ENUM, BOOLEAN, VARBINARY)
- **Contraintes CHECK** pour la validation des données
- **INDEX** pour optimiser les performances

**Prochaine section :** 16.2 Foreign Keys & Intégrité référentielle