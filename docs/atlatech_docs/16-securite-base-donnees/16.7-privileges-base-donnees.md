---
title: Privilèges Base de Données
sidebar_label: "16.7 Privilèges"
sidebar_position: 8
---

# 16.7 Privilèges Base de Données

## Introduction

La gestion des privilèges est cruciale pour appliquer le principe du moindre privilège et limiter les accès aux données sensibles.

### Principe du moindre privilège

**Pour les non-techniciens :** Chaque employé a accès uniquement aux pièces dont il a besoin. Un ouvrier ne devrait pas avoir la clé du coffre-fort.

**Pour les techniciens :** Chaque utilisateur de base de données ne doit avoir que les privilèges strictement nécessaires à son rôle.

---

## 16.7.1 État AVANT (Vulnérable)

### Problème : GRANT ALL PRIVILEGES

**Audit des privilèges :**

```sql
SELECT User, Host FROM mysql.user;
```

**Résultat :**

| User | Host |
|------|------|
| root | localhost |
| admin | % |
| webapp | localhost |

**Analyse du compte admin :**

```sql
SHOW GRANTS FOR 'admin'@'%';
```

**Résultat :**

```sql
GRANT ALL PRIVILEGES ON *.* TO 'admin'@'%' WITH GRANT OPTION
```

**Problèmes :**
- `ALL PRIVILEGES` = Peut tout faire (CREATE, DROP, SELECT, INSERT, UPDATE, DELETE)
- `ON *.*` = Sur toutes les bases de données
- `WITH GRANT OPTION` = Peut créer d'autres super-admins
- `@'%'` = Connexion depuis n'importe quelle IP

**Impact :** Un compte compromis = compromission totale du serveur.

---

## 16.7.2 État APRÈS (Sécurisé)

### Stratégie de privilèges granulaires

**Principe :** Créer des utilisateurs dédiés avec privilèges minimaux.

#### Utilisateur pour l'application Site Web

```sql
-- Créer l'utilisateur
CREATE USER 'web_app_user'@'localhost' 
IDENTIFIED BY 'Web$ecur3!2026Pass';

-- Privilèges SELECT, INSERT, UPDATE uniquement sur tables produits/clients/commandes
GRANT SELECT, INSERT, UPDATE ON atlastech_db.produits TO 'web_app_user'@'localhost';
GRANT SELECT, INSERT, UPDATE ON atlastech_db.clients TO 'web_app_user'@'localhost';
GRANT SELECT, INSERT, UPDATE ON atlastech_db.commandes TO 'web_app_user'@'localhost';
GRANT SELECT, INSERT, UPDATE ON atlastech_db.details_commande TO 'web_app_user'@'localhost';

-- AUCUN accès aux tables RH
-- AUCUN DELETE (les suppressions se font via procédure stockée)
-- AUCUN DROP, CREATE, ALTER

FLUSH PRIVILEGES;
```

**Vérification :**

```sql
SHOW GRANTS FOR 'web_app_user'@'localhost';
```

**Résultat :**

```sql
GRANT USAGE ON *.* TO 'web_app_user'@'localhost'
GRANT SELECT, INSERT, UPDATE ON `atlastech_db`.`produits` TO 'web_app_user'@'localhost'
GRANT SELECT, INSERT, UPDATE ON `atlastech_db`.`clients` TO 'web_app_user'@'localhost'
GRANT SELECT, INSERT, UPDATE ON `atlastech_db`.`commandes` TO 'web_app_user'@'localhost'
GRANT SELECT, INSERT, UPDATE ON `atlastech_db`.`details_commande` TO 'web_app_user'@'localhost'
```

**Test de sécurité :**

```bash
mysql -u web_app_user -p
```

```sql
-- Tentative d'accès à une table RH
SELECT * FROM employes;
-- ERROR 1142 (42000): SELECT command denied to user 'web_app_user'@'localhost' for table 'employes'

-- Tentative de suppression
DELETE FROM produits WHERE produit_id = 1;
-- ERROR 1142 (42000): DELETE command denied to user 'web_app_user'@'localhost' for table 'produits'

-- Tentative de DROP
DROP TABLE produits;
-- ERROR 1142 (42000): DROP command denied to user 'web_app_user'@'localhost' for table 'produits'
```

#### Utilisateur pour l'application CRUD RH

```sql
-- Créer l'utilisateur
CREATE USER 'hr_app_user'@'localhost' 
IDENTIFIED BY 'HR$ecur3!2026Pass';

-- Privilèges complets sur tables RH uniquement
GRANT SELECT, INSERT, UPDATE, DELETE ON atlastech_db.employes TO 'hr_app_user'@'localhost';
GRANT SELECT, INSERT, UPDATE, DELETE ON atlastech_db.departements TO 'hr_app_user'@'localhost';
GRANT SELECT, INSERT, UPDATE, DELETE ON atlastech_db.conges TO 'hr_app_user'@'localhost';
GRANT SELECT ON atlastech_db.salaires TO 'hr_app_user'@'localhost';  -- SELECT uniquement

-- AUCUN accès aux tables Site Web
-- AUCUN DELETE sur salaires (sensible)

FLUSH PRIVILEGES;
```

#### Utilisateur en lecture seule (Reporting)

```sql
-- Créer l'utilisateur pour les rapports
CREATE USER 'reporting_user'@'localhost' 
IDENTIFIED BY 'Report!2026Read';

-- SELECT uniquement sur toutes les tables
GRANT SELECT ON atlastech_db.* TO 'reporting_user'@'localhost';

FLUSH PRIVILEGES;
```

---

## 16.7.3 Privilèges par colonne

### Masquage de colonnes sensibles

**Scénario :** L'équipe commerciale peut voir les employés, mais PAS les salaires.

```sql
-- Créer l'utilisateur commercial
CREATE USER 'commercial_user'@'localhost' 
IDENTIFIED BY 'Com$ecur3!2026';

-- Accès SELECT sur colonnes spécifiques uniquement
GRANT SELECT (employe_id, nom, prenom, email, poste, departement_id) 
ON atlastech_db.employes 
TO 'commercial_user'@'localhost';

FLUSH PRIVILEGES;
```

**Test :**

```sql
-- Connexion en tant que commercial_user
mysql -u commercial_user -p

-- SELECT sur colonnes autorisées : OK
SELECT employe_id, nom, prenom, email FROM employes;
-- Query OK

-- SELECT sur colonne salaire : REFUSÉ
SELECT nom, salaire FROM employes;
-- ERROR 1143 (42000): SELECT command denied to user 'commercial_user'@'localhost' for column 'salaire' in table 'employes'
```

---

## 16.7.4 Privilèges sur procédures stockées

### EXECUTE uniquement

```sql
-- Révoquer tous les privilèges directs sur les tables
REVOKE ALL PRIVILEGES ON atlastech_db.* FROM 'hr_app_user'@'localhost';

-- Donner uniquement EXECUTE sur les procédures
GRANT EXECUTE ON PROCEDURE atlastech_db.creer_employe TO 'hr_app_user'@'localhost';
GRANT EXECUTE ON PROCEDURE atlastech_db.modifier_employe TO 'hr_app_user'@'localhost';
GRANT EXECUTE ON PROCEDURE atlastech_db.supprimer_employe TO 'hr_app_user'@'localhost';
GRANT EXECUTE ON PROCEDURE atlastech_db.calculer_solde_conges TO 'hr_app_user'@'localhost';

FLUSH PRIVILEGES;
```

**Avantage :** L'application ne peut QUE appeler les procédures (qui contiennent la logique de validation).

**Test :**

```sql
-- Connexion en tant que hr_app_user
mysql -u hr_app_user -p

-- Appel de procédure : OK
CALL creer_employe('test', 'pass', 'Test', 'User', 'test@test.ma', 2, 'CDI', 'Dev', @id);
-- Query OK

-- SELECT direct : REFUSÉ
SELECT * FROM employes;
-- ERROR 1142 (42000): SELECT command denied
```

---

## 16.7.5 Restriction par IP

### Utilisateurs limités à des IPs spécifiques

**Scénario :** L'admin peut se connecter UNIQUEMENT depuis le réseau local.

```sql
-- Supprimer le compte admin@%
DROP USER 'admin'@'%';

-- Créer un compte limité au réseau local
CREATE USER 'admin_local'@'192.168.%.%' 
IDENTIFIED BY 'AdminLocal!2026Sec';

-- Privilèges restreints
GRANT SELECT, INSERT, UPDATE ON atlastech_db.* TO 'admin_local'@'192.168.%.%';
-- PAS de DELETE, DROP, CREATE, ALTER

FLUSH PRIVILEGES;
```

**Test de connexion :**

```bash
# Depuis le réseau local (192.168.x.x) : OK
mysql -h 192.168.10.20 -u admin_local -p

# Depuis Internet : REFUSÉ
mysql -h atlastech.com -u admin_local -p
-- ERROR 1130 (HY000): Host '203.0.113.45' is not allowed to connect to this MariaDB server
```

---

## 16.7.6 Audit des privilèges

### Lister tous les utilisateurs et leurs privilèges

```sql
SELECT 
    User,
    Host,
    Select_priv,
    Insert_priv,
    Update_priv,
    Delete_priv,
    Create_priv,
    Drop_priv,
    Grant_priv,
    Super_priv,
    File_priv
FROM mysql.user
WHERE User NOT IN ('mysql.sys', 'mysql.session', 'mysql.infoschema');
```

**Résultat sécurisé :**

| User | Host | Select | Insert | Update | Delete | Create | Drop | Grant | Super | File |
|------|------|--------|--------|--------|--------|--------|------|-------|-------|------|
| root | localhost | Y | Y | Y | Y | Y | Y | N | Y | Y |
| web_app_user | localhost | N | N | N | N | N | N | N | N | N |
| hr_app_user | localhost | N | N | N | N | N | N | N | N | N |
| reporting_user | localhost | N | N | N | N | N | N | N | N | N |

**Analyse :**
- Seul `root@localhost` a des privilèges élevés
- Aucun utilisateur applicatif n'a `Super_priv`, `Grant_priv`, ou `File_priv`
- Aucun utilisateur accessible depuis `%` (Internet)

### Détecter les comptes avec privilèges excessifs

```sql
-- Comptes avec GRANT OPTION
SELECT User, Host 
FROM mysql.user 
WHERE Grant_priv = 'Y';

-- Comptes avec FILE (lecture de fichiers système)
SELECT User, Host 
FROM mysql.user 
WHERE File_priv = 'Y';

-- Comptes avec SUPER (peut tout faire)
SELECT User, Host 
FROM mysql.user 
WHERE Super_priv = 'Y';
```

**Résultat attendu :**

| User | Host |
|------|------|
| root | localhost |

**Tout autre utilisateur dans ces résultats = problème de sécurité !**

---

## 16.7.7 Rotation des mots de passe

### Politique de changement de mot de passe

```sql
-- Forcer le changement de mot de passe tous les 90 jours
ALTER USER 'web_app_user'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;
ALTER USER 'hr_app_user'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;

-- Vérifier la politique
SELECT User, Host, password_lifetime 
FROM mysql.user 
WHERE User LIKE '%_app_%';
```

**Résultat :**

| User | Host | password_lifetime |
|------|------|-------------------|
| web_app_user | localhost | 90 |
| hr_app_user | localhost | 90 |

### Changement de mot de passe

```sql
-- Changer le mot de passe d'un utilisateur
ALTER USER 'web_app_user'@'localhost' 
IDENTIFIED BY 'NewWeb$ecur3!2026Pass';

FLUSH PRIVILEGES;
```

---

## 16.7.8 Suppression des comptes inutiles

### Audit et nettoyage

```sql
-- Lister tous les comptes
SELECT User, Host, password_last_changed, password_lifetime
FROM mysql.user;

-- Supprimer les comptes non utilisés
DROP USER IF EXISTS 'old_user'@'localhost';
DROP USER IF EXISTS 'test'@'%';

-- Supprimer le compte admin vulnérable
DROP USER IF EXISTS 'admin'@'%';

-- Vérification
SELECT User, Host FROM mysql.user 
WHERE User NOT IN ('root', 'mysql.sys', 'mysql.session', 'mysql.infoschema');
```

**Résultat final (sécurisé) :**

| User | Host |
|------|------|
| root | localhost |
| web_app_user | localhost |
| hr_app_user | localhost |
| reporting_user | localhost |
| admin_local | 192.168.%.% |

---

## 16.7.9 Matrice des privilèges

### Tableau récapitulatif

| Utilisateur | SELECT | INSERT | UPDATE | DELETE | CREATE | DROP | EXECUTE | Tables accessibles |
|-------------|--------|--------|--------|--------|--------|------|---------|-------------------|
| **root@localhost** | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ | Toutes |
| **web_app_user** | ✓ | ✓ | ✓ | ✗ | ✗ | ✗ | ✗ | produits, clients, commandes |
| **hr_app_user** | ✗ | ✗ | ✗ | ✗ | ✗ | ✗ | ✓ | Procédures RH uniquement |
| **reporting_user** | ✓ | ✗ | ✗ | ✗ | ✗ | ✗ | ✗ | Toutes (lecture seule) |
| **commercial_user** | ✓ | ✗ | ✗ | ✗ | ✗ | ✗ | ✗ | employes (colonnes limitées) |

---

## 16.7.10 Script de configuration complet

**Fichier : `configure_privileges.sql`**

```sql
-- ============================================
-- Configuration des privilèges AtlasTech
-- ============================================

-- Supprimer les comptes vulnérables
DROP USER IF EXISTS 'admin'@'%';
DROP USER IF EXISTS 'webapp'@'%';

-- Application Site Web
CREATE USER 'web_app_user'@'localhost' IDENTIFIED BY 'Web$ecur3!2026Pass';
GRANT SELECT, INSERT, UPDATE ON atlastech_db.produits TO 'web_app_user'@'localhost';
GRANT SELECT, INSERT, UPDATE ON atlastech_db.clients TO 'web_app_user'@'localhost';
GRANT SELECT, INSERT, UPDATE ON atlastech_db.commandes TO 'web_app_user'@'localhost';
GRANT SELECT, INSERT, UPDATE ON atlastech_db.details_commande TO 'web_app_user'@'localhost';
ALTER USER 'web_app_user'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;

-- Application CRUD RH
CREATE USER 'hr_app_user'@'localhost' IDENTIFIED BY 'HR$ecur3!2026Pass';
GRANT EXECUTE ON PROCEDURE atlastech_db.creer_employe TO 'hr_app_user'@'localhost';
GRANT EXECUTE ON PROCEDURE atlastech_db.modifier_employe TO 'hr_app_user'@'localhost';
GRANT EXECUTE ON PROCEDURE atlastech_db.supprimer_employe TO 'hr_app_user'@'localhost';
GRANT EXECUTE ON PROCEDURE atlastech_db.calculer_solde_conges TO 'hr_app_user'@'localhost';
ALTER USER 'hr_app_user'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;

-- Reporting
CREATE USER 'reporting_user'@'localhost' IDENTIFIED BY 'Report!2026Read';
GRANT SELECT ON atlastech_db.* TO 'reporting_user'@'localhost';

-- Admin local
CREATE USER 'admin_local'@'192.168.%.%' IDENTIFIED BY 'AdminLocal!2026Sec';
GRANT SELECT, INSERT, UPDATE ON atlastech_db.* TO 'admin_local'@'192.168.%.%';

FLUSH PRIVILEGES;

-- Audit final
SELECT User, Host, Select_priv, Insert_priv, Update_priv, Delete_priv
FROM mysql.user
WHERE User NOT IN ('mysql.sys', 'mysql.session', 'mysql.infoschema', 'root');
```

**Exécution :**

```bash
mysql -u root -p < configure_privileges.sql
```

---

## Conclusion

Les privilèges granulaires implémentés dans AtlasTech Solutions :

**Sécurité :**
- Principe du moindre privilège appliqué à 100%
- Séparation stricte des rôles (Site Web vs RH)
- Aucun utilisateur avec `GRANT OPTION` sauf root
- Restriction des connexions par IP

**Utilisateurs créés :**
- 4 utilisateurs applicatifs (privilèges minimaux)
- 1 utilisateur reporting (lecture seule)
- 1 admin local (réseau interne uniquement)

**Conformité :**
- ISO 27001 A.9.2.3 (Gestion des privilèges d'accès)
- CIS MariaDB Benchmark 2.4 (Principle of Least Privilege)

**Prochaine section :** 16.8 Chiffrement des Données Sensibles