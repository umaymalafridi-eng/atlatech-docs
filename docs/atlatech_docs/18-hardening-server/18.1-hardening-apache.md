---
title: Hardening Apache
sidebar_label: "18.1 Hardening Apache"
sidebar_position: 1
---

# 18.1 Hardening Serveurs Web (Apache)

## Introduction

Le durcissement d'Apache consiste à désactiver les modules inutiles, masquer les informations de version, et configurer les en-têtes de sécurité.

---

## 18.1.1 Masquage des informations du serveur

**Fichier de configuration :**

```bash
sudo nano /etc/apache2/conf-available/security.conf
```

**Modifications :**

```apache
# Masquer la version Apache et l'OS
ServerTokens Prod
ServerSignature Off

# Désactiver TRACE (protection XST)
TraceEnable Off
```

**Application :**

```bash
sudo systemctl reload apache2

# Vérification
curl -I http://192.168.112.141/atlastech/login.php | grep Server
```

**Résultat attendu :**
```
Server: Apache
```
(au lieu de Server: Apache/2.4.52 (Ubuntu))

---

## 18.1.2 En-têtes de sécurité HTTP

**Configuration des headers sécurisés :**

```bash
sudo nano /etc/apache2/sites-available/atlastech-security.conf
```

**Ajouter :**

```apache
<IfModule mod_headers.c>
    # Protection XSS
    Header always set X-XSS-Protection "1; mode=block"
    
    # Prévention clickjacking
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # Prévention MIME sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # Politique de référence
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Content Security Policy
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';"
    
    # HTTPS Strict Transport Security (production uniquement)
    # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
    # Permissions Policy
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>
```

**Activer mod_headers :**

```bash
sudo a2enmod headers
sudo systemctl reload apache2
```

**Vérification :**

```bash
curl -I http://192.168.112.141/atlastech/ | grep -E "X-Frame|X-XSS|X-Content"
```

---

## 18.1.3 Désactivation des modules inutiles

**Lister les modules actifs :**

```bash
apache2ctl -M
```

**Modules à désactiver (non utilisés par AtlasTech) :**

```bash
sudo a2dismod autoindex
sudo a2dismod status
sudo a2dismod userdir
sudo systemctl reload apache2
```

**Modules nécessaires (garder activés) :**
- mod_rewrite (URL rewriting)
- mod_ssl (HTTPS)
- mod_headers (sécurité)
- mod_php (exécution PHP)

---

## 18.1.4 Limitation des ressources

**Configuration anti-DoS :**

```apache
# Limiter la taille des requêtes
LimitRequestBody 10485760

# Limiter le nombre de champs dans les requêtes
LimitRequestFields 100
LimitRequestFieldSize 8190

# Timeout
Timeout 60
KeepAliveTimeout 5
MaxKeepAliveRequests 100
```

---

## Résultat

**Tableau de conformité CIS Apache :**

| Recommandation CIS | État Avant | État Après |
|-------------------|------------|------------|
| 3.1 Masquer version | FAIL | PASS |
| 3.2 Désactiver TRACE | FAIL | PASS |
| 5.7 Désactiver autoindex | FAIL | PASS |
| 9.1 Headers sécurité | FAIL | PASS |