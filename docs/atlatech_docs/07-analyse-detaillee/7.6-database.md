---
title:  Base de données MySQL/MariaDB
sidebar_label:  Base de données
sidebar_position: 8
---

# 7.6 Base de données MySQL/MariaDB

## Vue d'ensemble

Analyse complète de la base de données **atlastech_db** (MariaDB 10.11.14) dans son état vulnérable.

**Serveur:** `127.0.0.1:3306` (localhost uniquement)  
**SGBD:** MariaDB 10.11.14 (fork MySQL)  
**Encodage:** utf8mb4  
**Tables:** 2 principales (employes, departements)

---

## 7.6.1 Structure de la base

### Machine: MainServer
### Commande d'accès:

```bash
sudo mysql -u root atlastech_db
```

### Liste des bases

```sql
SHOW DATABASES;
```

**Résultat:**

```
+--------------------+
| Database           |
+--------------------+
| atlastech_db       |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
```

### Tables dans atlastech_db

```sql
USE atlastech_db;
SHOW TABLES;
```

**Résultat:**

```
+------------------------+
| Tables_in_atlastech_db |
+------------------------+
| departements           |
| employes               |
+------------------------+
```

---

## 7.6.2 Table employes - Structure

```sql
SHOW CREATE TABLE employes\G
```

**Résultat complet:**

```sql
CREATE TABLE `employes` (
  `id` int(11) NOT NULL,
  `utilisateur` varchar(50) DEFAULT NULL,
  `mot_de_passe` varchar(255) DEFAULT NULL,
  `prenom` varchar(100) DEFAULT NULL,
  `nom` varchar(100) DEFAULT NULL,
  `email` varchar(150) DEFAULT NULL,
  `departement_id` int(11) DEFAULT NULL,
  `poste` varchar(100) DEFAULT NULL,
  `type_contrat` varchar(20) DEFAULT NULL,
  `salaire` decimal(10,2) DEFAULT NULL,
  `cin` varchar(20) DEFAULT NULL,
  `ville` varchar(100) DEFAULT NULL,
  `numero_cnops` varchar(13) DEFAULT NULL,
  `statut_cnops` varchar(20) DEFAULT NULL,
  `is_admin` varchar(10) DEFAULT NULL,
  `commentaires` text DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**Vulnérabilités:**

| Champ | Type | Vulnérabilité | Gravité |
|-------|------|---------------|---------|
| `mot_de_passe` | varchar(255) | **Stockage en clair** | CRITIQUE |
| `salaire` | decimal | **Pas de chiffrement** | HAUTE |
| `cin` | varchar(20) | **Pas de chiffrement** | CRITIQUE |
| `is_admin` | varchar(10) | **Type inadéquat** (devrait être BOOLEAN) | MOYENNE |
| - | - | **Pas de Foreign Key** vers departements | MOYENNE |

---

## 7.6.3 Utilisateurs MySQL

```sql
SELECT User, Host FROM mysql.user;
```

**Résultat:**

```
+------------------+-----------+
| User             | Host      |
+------------------+-----------+
| admin            | %         |
| atlastech_user   | %         |
| root             | localhost |
| mysql            | localhost |
| mariadb.sys      | localhost |
+------------------+-----------+
```

**Analyse:**

| User | Host | Risque |
|------|------|--------|
| admin | **%** | CRITIQUE - Connexion depuis n'importe où |
| atlastech_user | **%** | HAUTE - Connexion depuis n'importe où |
| root | localhost | ACCEPTABLE - Local uniquement |

---

## 7.6.4 Privilèges (GRANTS)

### atlastech_user

```sql
SHOW GRANTS FOR 'atlastech_user'@'%';
```

**Résultat:**

```sql
GRANT USAGE ON *.* TO 'atlastech_user'@'%' 
IDENTIFIED BY PASSWORD '*A0F874BC7F54EE086FCE60A37CE7887D8B31086B';

GRANT ALL PRIVILEGES ON `atlastech_db`.* TO 'atlastech_user'@'%';
```

**Analyse:** 
- ALL PRIVILEGES sur atlastech_db (SELECT, INSERT, UPDATE, DELETE, DROP, CREATE)
- Mot de passe hashé faible: `password123`

### admin@'%'

```sql
SHOW GRANTS FOR 'admin'@'%';
```

**Résultat:**

```sql
GRANT ALL PRIVILEGES ON *.* TO 'admin'@'%' 
IDENTIFIED BY PASSWORD '*4ACFE3202A5FF5CF467898FC58AAB1D615029441' 
WITH GRANT OPTION;
```

**CRITIQUE:** 
- ALL PRIVILEGES sur **TOUTES** les bases (`*.*`)
- **WITH GRANT OPTION** → Peut créer d'autres utilisateurs
- Mot de passe: `admin` (trivial)

**Score CVSS: 9.3 (CRITIQUE)**

---

## 7.6.5 Variables de sécurité

```sql
SHOW VARIABLES LIKE '%local_infile%';
SHOW VARIABLES LIKE '%secure_file_priv%';
SHOW VARIABLES LIKE '%sql_mode%';
```

**Résultats:**

```
+------------------+--------+
| Variable_name    | Value  |
+------------------+--------+
| local_infile     | ON     |  ⚠️ CRITIQUE
| secure_file_priv | NULL   |  ⚠️ HAUTE
| sql_mode         | ...    |
+------------------+--------+
```

**Vulnérabilités:**

- `local_infile = ON` → Permet LOAD DATA LOCAL INFILE (lecture fichiers système)
- `secure_file_priv = NULL` → Aucune restriction sur lecture/écriture fichiers

---

## 7.6.6 Synthèse Database

**Vulnérabilités critiques:**
1. Mots de passe en clair (25 employés)
2. Utilisateur admin@% avec GRANT OPTION
3. local_infile activé
4. Aucune Foreign Key constraint
5. Pas de chiffrement des données sensibles

**Score global: 9.8/10 (CRITIQUE)**

---