---
id: architecture-application
title: Architecture Application
sidebar_label: "15.1 Architecture Application"
sidebar_position: 1
---

# 15.1 Architecture Application

## Introduction à la Sécurité Applicative

La sécurité applicative (Application Security) représente l'ensemble des mesures de protection mises en place au niveau du code et de l'architecture logicielle pour protéger les applications contre les cyberattaques. Dans le contexte d'AtlasTech Solutions, nous gérons deux applications web critiques qui nécessitent une approche de sécurisation rigoureuse.

**Pourquoi la sécurité applicative est-elle cruciale ?**

Selon l'OWASP (Open Web Application Security Project), plus de 90% des applications web présentent au moins une vulnérabilité de sécurité. Ces failles peuvent permettre à des attaquants de :
- Voler des données sensibles (informations personnelles, mots de passe, données financières)
- Modifier ou supprimer des informations critiques
- Prendre le contrôle de l'application ou du serveur
- Interrompre les services (déni de service)

:::info Contexte AtlasTech Solutions
AtlasTech Solutions gère des données hautement sensibles incluant :
- Informations clients et prospects (conformité RGPD)
- Données RH des 25 employés (salaires, contrats, documents personnels)
- Code source propriétaire des applications développées
- Informations financières et de facturation
:::

---

## Vue d'Ensemble de l'Architecture Applicative

L'infrastructure d'AtlasTech Solutions repose sur **deux applications web distinctes** mais interconnectées, chacune ayant des besoins de sécurité spécifiques.

### Schéma d'Architecture Global

```
┌─────────────────────────────────────────────────────────────────┐
│                         INTERNET PUBLIC                         │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
                    ┌───────────────────────┐
                    │   Pare-feu FortiGate  │
                    │   + WAF (Web App FW)  │
                    └───────────────────────┘
                                │
                ┌───────────────┴───────────────┐
                │                               │
                ▼                               ▼
    ┌─────────────────────┐         ┌─────────────────────┐
    │    VLAN 10 - DMZ    │         │  VLAN 20 - Interne  │
    │  (Zone Publique)    │         │   (Zone Privée)     │
    └─────────────────────┘         └─────────────────────┘
                │                               │
                ▼                               ▼
    ┌─────────────────────┐         ┌─────────────────────┐
    │  Serveur Web Apache │         │  Application CRUD   │
    │  192.168.10.10      │         │  RH (Interne)       │
    │                     │         │  192.168.20.10      │
    │  Site Commercial    │         │                     │
    │  - Frontend         │         │  Interface PHP      │
    │  - Backend PHP      │         │  Gestion Employés   │
    └─────────────────────┘         └─────────────────────┘
                │                               │
                └───────────────┬───────────────┘
                                ▼
                    ┌───────────────────────┐
                    │   VLAN 30 - Data      │
                    │   Serveur MariaDB     │
                    │   192.168.30.10       │
                    │                       │
                    │   - DB atlastech_web  │
                    │   - DB atlastech_rh   │
                    └───────────────────────┘
```

---

## 15.1.1 Application Web Commerciale (Site Public)

### Description Fonctionnelle

Le site web commercial d'AtlasTech Solutions constitue la vitrine numérique de l'entreprise. C'est l'interface principale de contact avec les clients et prospects.

**Objectifs métier :**
- Présenter les services de développement web proposés
- Générer des leads commerciaux via formulaires de contact
- Vendre des packs de développement web (sites vitrines, e-commerce, maintenance)
- Gérer les demandes de devis en ligne
- Afficher un portfolio de projets réalisés

### Stack Technique Frontend

Le frontend représente la partie visible de l'application, celle avec laquelle l'utilisateur interagit directement dans son navigateur web.

**Technologies utilisées :**

```
Frontend (Client-Side)
├── HTML5 (Structure sémantique)
├── CSS3 (Stylisation)
│   ├── Framework : Tailwind CSS 3.x
│   └── Responsive Design (Mobile-First)
├── JavaScript ES6+ (Interactivité)
│   ├── Vanilla JS (manipulation DOM)
│   ├── AJAX/Fetch API (requêtes asynchrones)
│   └── Validation côté client
└── Bibliothèques tierces
    ├── AOS.js (animations au scroll)
    └── SwiperJS (carrousels)
```

**Vérification de la configuration frontend :**

```bash
# Connexion au serveur web
ssh admin@192.168.10.10

# Vérification de la structure des fichiers
ls -la /var/www/html/atlastech-commercial/

# Résultat attendu :
drwxr-xr-x 8 www-data www-data 4096 Jan 15 10:00 .
drwxr-xr-x 3 root     root     4096 Jan 10 08:00 ..
-rw-r--r-- 1 www-data www-data 5432 Jan 15 10:00 index.php
drwxr-xr-x 2 www-data www-data 4096 Jan 15 10:00 assets/
drwxr-xr-x 2 www-data www-data 4096 Jan 15 10:00 css/
drwxr-xr-x 2 www-data www-data 4096 Jan 15 10:00 js/
drwxr-xr-x 2 www-data www-data 4096 Jan 15 10:00 includes/
drwxr-xr-x 2 www-data www-data 4096 Jan 15 10:00 config/

# Vérification du contenu des fichiers HTML/PHP
head -n 20 /var/www/html/atlastech-commercial/index.php
```

**Résultat de la vérification :**

```php
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AtlasTech Solutions - Développement Web Professionnel</title>
    <link rel="stylesheet" href="/css/tailwind.min.css">
    <link rel="stylesheet" href="/css/custom.css">
</head>
<body>
    <?php 
    require_once 'config/database.php';
    require_once 'includes/functions.php';
    ?>
    
    <!-- Hero Section -->
    <section class="hero-section">
        <h1>Solutions Web sur Mesure pour PME</h1>
        <!-- Contenu de la page -->
```

### Stack Technique Backend

Le backend représente la logique métier de l'application, exécutée côté serveur. Il traite les données, communique avec la base de données et génère le contenu dynamique.

**Technologies utilisées :**

```
Backend (Server-Side)
├── Serveur Web : Apache 2.4.52
│   ├── mod_php activé
│   ├── mod_rewrite (URL rewriting)
│   └── mod_ssl (HTTPS)
├── Langage : PHP 8.1
│   ├── Extensions : mysqli, pdo_mysql, mbstring, gd
│   └── Configuration sécurisée (php.ini)
└── Base de données : MariaDB 10.6
    └── Base : atlastech_web
```

**Vérification de la configuration Apache :**

```bash
# Vérification de la version Apache
apache2 -v

# Résultat :
Server version: Apache/2.4.52 (Ubuntu)
Server built:   2023-10-15T10:30:00

# Liste des modules activés
apache2ctl -M | grep -E 'php|rewrite|ssl'

# Résultat attendu :
php_module (shared)
rewrite_module (shared)
ssl_module (shared)

# Vérification de la configuration du VirtualHost
cat /etc/apache2/sites-enabled/atlastech-commercial.conf
```

**Configuration Apache du site commercial :**

```apache
<VirtualHost *:443>
    ServerName www.atlastech.ma
    ServerAlias atlastech.ma
    DocumentRoot /var/www/html/atlastech-commercial

    # Certificat SSL/TLS
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/atlastech.ma/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/atlastech.ma/privkey.pem

    # Configuration PHP
    <FilesMatch \.php$>
        SetHandler "proxy:unix:/run/php/php8.1-fpm.sock|fcgi://localhost"
    </FilesMatch>

    # Sécurité : Désactivation de l'affichage des répertoires
    <Directory /var/www/html/atlastech-commercial>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Protection des fichiers sensibles
    <FilesMatch "\.(env|ini|log|sql)$">
        Require all denied
    </FilesMatch>

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/atlastech-commercial-error.log
    CustomLog ${APACHE_LOG_DIR}/atlastech-commercial-access.log combined
</VirtualHost>

# Redirection HTTP vers HTTPS
<VirtualHost *:80>
    ServerName www.atlastech.ma
    ServerAlias atlastech.ma
    Redirect permanent / https://www.atlastech.ma/
</VirtualHost>
```

**Vérification de la configuration PHP :**

```bash
# Version PHP installée
php -v

# Résultat :
PHP 8.1.27 (cli) (built: Dec 15 2023 10:00:00) ( NTS )
Copyright (c) The PHP Group
Zend Engine v4.1.27, Copyright (c) Zend Technologies
    with Zend OPcache v8.1.27, Copyright (c), by Zend Technologies

# Extensions PHP critiques
php -m | grep -E 'pdo|mysqli|mbstring|gd|openssl'

# Résultat attendu :
gd
mbstring
mysqli
openssl
pdo_mysql
PDO

# Vérification de la configuration de sécurité PHP
php -i | grep -E 'display_errors|expose_php|file_uploads'

# Résultat attendu (configuration sécurisée) :
display_errors => Off => Off
expose_php => Off => Off
file_uploads => On => On
```

### Architecture de la Base de Données - Site Commercial

**Schéma de la base de données `atlastech_web` :**

```sql
-- Connexion à la base de données
mysql -u root -p

USE atlastech_web;

-- Affichage des tables
SHOW TABLES;

-- Résultat :
+---------------------------+
| Tables_in_atlastech_web   |
+---------------------------+
| services                  |
| packs                     |
| clients                   |
| commandes                 |
| demandes_devis            |
| portfolio                 |
| blog_articles             |
| contacts                  |
| users_web                 |
+---------------------------+
```

**Structure de la table `services` :**

```sql
-- Description de la structure
DESCRIBE services;

-- Résultat :
+-----------------+--------------+------+-----+---------+----------------+
| Field           | Type         | Null | Key | Default | Extra          |
+-----------------+--------------+------+-----+---------+----------------+
| id              | int(11)      | NO   | PRI | NULL    | auto_increment |
| nom_service     | varchar(255) | NO   |     | NULL    |                |
| description     | text         | YES  |     | NULL    |                |
| prix_base       | decimal(10,2)| NO   |     | NULL    |                |
| image_url       | varchar(500) | YES  |     | NULL    |                |
| actif           | tinyint(1)   | NO   |     | 1       |                |
| created_at      | timestamp    | NO   |     | current_timestamp() |     |
| updated_at      | timestamp    | YES  |     | NULL    |                |
+-----------------+--------------+------+-----+---------+----------------+

-- Exemple de données
SELECT * FROM services LIMIT 3;

-- Résultat :
+----+------------------+-------------------------+----------+--------------------------+-------+
| id | nom_service      | description             | prix_base| image_url                | actif |
+----+------------------+-------------------------+----------+--------------------------+-------+
|  1 | Site Vitrine     | Site 5-10 pages         | 8000.00  | /img/services/vitrine.jpg|   1   |
|  2 | E-commerce       | Boutique en ligne       | 25000.00 | /img/services/ecom.jpg   |   1   |
|  3 | Application Web  | App métier sur mesure   | 50000.00 | /img/services/webapp.jpg |   1   |
+----+------------------+-------------------------+----------+--------------------------+-------+
```

---

## 15.1.2 Application CRUD Ressources Humaines (Application Interne)

### Description Fonctionnelle

L'application CRUD (Create, Read, Update, Delete) RH est une interface web interne réservée exclusivement au département Ressources Humaines d'AtlasTech Solutions. Elle permet la gestion centralisée des informations des 25 employés de l'entreprise.

**Fonctionnalités métier :**

1. **Create (Créer)** : Ajouter un nouvel employé au système
2. **Read (Lire)** : Consulter la liste complète des employés et leurs détails
3. **Update (Modifier)** : Mettre à jour les informations d'un employé existant
4. **Delete (Supprimer)** : Retirer un employé du système (départ de l'entreprise)

**Données gérées par l'application :**

```
Informations Employé
├── Données d'identification
│   ├── Nom complet (prénom, nom)
│   ├── CIN (Carte d'Identité Nationale)
│   ├── Date de naissance
│   └── Photo (upload fichier)
├── Informations de contact
│   ├── Email professionnel
│   ├── Téléphone portable
│   └── Adresse complète
├── Données professionnelles
│   ├── Poste occupé
│   ├── Département
│   ├── Date d'embauche
│   ├── Salaire mensuel (CONFIDENTIEL)
│   └── Statut (CDI, CDD, Stage)
└── Documents RH
    ├── Contrat de travail (PDF)
    ├── Attestation de travail
    └── Bulletins de paie
```

### Stack Technique Application CRUD

**Architecture simplifiée :**

```
Application CRUD RH
├── Interface Web (Frontend)
│   ├── HTML5 + Bootstrap 5
│   ├── JavaScript (validation formulaires)
│   └── DataTables.js (tableaux interactifs)
├── Logique Métier (Backend)
│   ├── PHP 8.1 (procédural/orienté objet)
│   ├── PDO (connexion base de données)
│   └── Sessions PHP (authentification)
└── Stockage Données
    ├── MariaDB (base atlastech_rh)
    └── Système de fichiers (photos, documents)
```

**Localisation de l'application :**

```bash
# Connexion au serveur interne
ssh admin@192.168.20.10

# Structure de l'application CRUD
ls -la /var/www/html/crud-rh/

# Résultat :
drwxr-x--- 10 www-data www-data 4096 Jan 15 10:00 .
drwxr-xr-x  3 root     root     4096 Jan 10 08:00 ..
-rw-r----- 1 www-data www-data 2341 Jan 15 10:00 index.php
-rw-r----- 1 www-data www-data 3456 Jan 15 10:00 login.php
-rw-r----- 1 www-data www-data 1234 Jan 15 10:00 logout.php
drwxr-x--- 2 www-data www-data 4096 Jan 15 10:00 config/
drwxr-x--- 2 www-data www-data 4096 Jan 15 10:00 employes/
drwxr-x--- 2 www-data www-data 4096 Jan 15 10:00 includes/
drwxr-x--- 2 www-data www-data 4096 Jan 15 10:00 assets/
drwx------ 2 www-data www-data 4096 Jan 15 10:00 uploads/

# Contenu du dossier employes (CRUD operations)
ls -la /var/www/html/crud-rh/employes/

# Résultat :
-rw-r----- 1 www-data www-data 5678 Jan 15 10:00 liste.php        (Read - Liste)
-rw-r----- 1 www-data www-data 4321 Jan 15 10:00 ajouter.php      (Create)
-rw-r----- 1 www-data www-data 4567 Jan 15 10:00 modifier.php     (Update)
-rw-r----- 1 www-data www-data 2345 Jan 15 10:00 supprimer.php    (Delete)
-rw-r----- 1 www-data www-data 3210 Jan 15 10:00 voir_detail.php  (Read - Détail)
```

### Configuration du VirtualHost CRUD RH

**Fichier `/etc/apache2/sites-enabled/crud-rh.conf` :**

```apache
<VirtualHost 192.168.20.10:443>
    ServerName rh-interne.atlastech.local
    DocumentRoot /var/www/html/crud-rh

    # IMPORTANT : Application strictement interne
    # Accessible uniquement depuis le réseau VLAN 20 (192.168.20.0/24)
    
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/atlastech-internal.crt
    SSLCertificateKeyFile /etc/ssl/private/atlastech-internal.key

    <Directory /var/www/html/crud-rh>
        Options -Indexes -FollowSymLinks
        AllowOverride None
        
        # Restriction d'accès par IP (VLAN 20 uniquement)
        Require ip 192.168.20.0/24
        
        # Protection supplémentaire
        <RequireAll>
            Require ip 192.168.20.0/24
            Require not ip 0.0.0.0/0
        </RequireAll>
    </Directory>

    # Dossier uploads (photos employés)
    <Directory /var/www/html/crud-rh/uploads>
        Options -Indexes -ExecCGI
        AllowOverride None
        Require ip 192.168.20.0/24
        
        # Interdiction d'exécution de scripts
        <FilesMatch "\.(php|phtml|php3|php4|php5|pl|py|cgi)$">
            Require all denied
        </FilesMatch>
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/crud-rh-error.log
    CustomLog ${APACHE_LOG_DIR}/crud-rh-access.log combined
</VirtualHost>
```

**Vérification de la restriction d'accès :**

```bash
# Depuis un poste du VLAN 20 (département RH) - DOIT FONCTIONNER
curl -k https://192.168.20.10/

# Résultat attendu :
HTTP/1.1 200 OK
<!DOCTYPE html>
<html>
<head><title>CRUD RH - Connexion</title></head>
...

# Depuis un poste du VLAN 10 (DMZ) - DOIT ÊTRE BLOQUÉ
curl -k https://192.168.20.10/

# Résultat attendu :
HTTP/1.1 403 Forbidden
<html><head>
<title>403 Forbidden</title>
</head><body>
<h1>Forbidden</h1>
<p>You don't have permission to access this resource.</p>
</body></html>
```

### Architecture de la Base de Données - Application RH

**Schéma de la base de données `atlastech_rh` :**

```sql
-- Connexion à MariaDB
mysql -u root -p -h 192.168.30.10

USE atlastech_rh;

-- Affichage des tables
SHOW TABLES;

-- Résultat :
+-------------------------+
| Tables_in_atlastech_rh  |
+-------------------------+
| employes                |
| departements            |
| postes                  |
| documents_employes      |
| historique_salaires     |
| conges                  |
| users_rh                |
+-------------------------+
```

**Structure détaillée de la table `employes` :**

```sql
-- Structure de la table principale
DESCRIBE employes;

-- Résultat :
+---------------------+--------------+------+-----+---------+----------------+
| Field               | Type         | Null | Key | Default | Extra          |
+---------------------+--------------+------+-----+---------+----------------+
| id                  | int(11)      | NO   | PRI | NULL    | auto_increment |
| cin                 | varchar(20)  | NO   | UNI | NULL    |                |
| prenom              | varchar(100) | NO   |     | NULL    |                |
| nom                 | varchar(100) | NO   |     | NULL    |                |
| date_naissance      | date         | NO   |     | NULL    |                |
| email               | varchar(255) | NO   | UNI | NULL    |                |
| telephone           | varchar(20)  | YES  |     | NULL    |                |
| adresse             | text         | YES  |     | NULL    |                |
| departement_id      | int(11)      | NO   | MUL | NULL    |                |
| poste_id            | int(11)      | NO   | MUL | NULL    |                |
| date_embauche       | date         | NO   |     | NULL    |                |
| salaire_mensuel     | decimal(10,2)| NO   |     | NULL    |                |
| type_contrat        | enum(...)    | NO   |     | CDI     |                |
| statut              | enum(...)    | NO   |     | actif   |                |
| photo_url           | varchar(500) | YES  |     | NULL    |                |
| created_at          | timestamp    | NO   |     | current_timestamp() |     |
| updated_at          | timestamp    | YES  |     | NULL    | on update ...  |
| created_by          | int(11)      | YES  | MUL | NULL    |                |
| updated_by          | int(11)      | YES  | MUL | NULL    |                |
+---------------------+--------------+------+-----+---------+----------------+

-- Contraintes de clés étrangères
SHOW CREATE TABLE employes\G

-- Résultat (extrait) :
CONSTRAINT `fk_employes_departement` FOREIGN KEY (`departement_id`) 
    REFERENCES `departements` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE,
CONSTRAINT `fk_employes_poste` FOREIGN KEY (`poste_id`) 
    REFERENCES `postes` (`id`) ON DELETE RESTRICT ON UPDATE CASCADE
```

**Exemple de données (anonymisées) :**

```sql
-- Consultation des employés (sans données sensibles)
SELECT 
    id, 
    CONCAT(prenom, ' ', nom) AS nom_complet,
    email,
    d.nom_departement,
    p.titre_poste,
    DATE_FORMAT(date_embauche, '%d/%m/%Y') AS embauche,
    statut
FROM employes e
JOIN departements d ON e.departement_id = d.id
JOIN postes p ON e.poste_id = p.id
ORDER BY nom_complet
LIMIT 5;

-- Résultat :
+----+------------------+-------------------------+----------------+----------------------+------------+--------+
| id | nom_complet      | email                   | nom_departement| titre_poste          | embauche   | statut |
+----+------------------+-------------------------+----------------+----------------------+------------+--------+
|  1 | Ahmed Alami      | a.alami@atlastech.ma    | IT             | Administrateur Sys   | 15/01/2020 | actif  |
|  2 | Fatima Bennis    | f.bennis@atlastech.ma   | RH             | Responsable RH       | 10/03/2019 | actif  |
|  3 | Karim El Mansouri| k.elmansouri@atlastech.ma| Développement | Développeur Senior   | 22/06/2021 | actif  |
|  4 | Samira Tazi      | s.tazi@atlastech.ma     | Commercial     | Chargée de clientèle | 05/09/2022 | actif  |
|  5 | Youssef Idrissi  | y.idrissi@atlastech.ma  | Finance        | Comptable            | 12/11/2020 | actif  |
+----+------------------+-------------------------+----------------+----------------------+------------+--------+
```

---

## 15.1.3 Flux de Données entre les Deux Applications

### Principe de Séparation des Données

Les deux applications (Site Commercial et CRUD RH) opèrent dans des **contextes de sécurité totalement distincts** et ne doivent **PAS** partager directement de données sensibles.

**Pourquoi cette séparation est-elle critique ?**

1. **Principe du moindre privilège** : Chaque application n'accède qu'aux données strictement nécessaires
2. **Limitation de la surface d'attaque** : Une compromission du site public ne doit PAS exposer les données RH
3. **Conformité RGPD** : Séparation des données personnelles selon leur finalité
4. **Audit et traçabilité** : Chaque application a ses propres logs d'accès

### Diagramme de Flux de Données

```
┌─────────────────────────────────────────────────────────────────────┐
│                          UTILISATEURS                               │
└─────────────────────────────────────────────────────────────────────┘
         │                                              │
         │ (1) Clients/Prospects                        │ (2) Département RH
         │     Internet Public                          │     Réseau Interne
         ▼                                              ▼
┌──────────────────────┐                    ┌──────────────────────┐
│  VLAN 10 - DMZ       │                    │  VLAN 20 - Interne   │
│                      │                    │                      │
│  Site Commercial     │  Flux limité (3)   │  Application CRUD RH │
│  192.168.10.10:443   │◄──────────────────►│  192.168.20.10:443   │
│                      │  API read-only     │                      │
└──────────────────────┘                    └──────────────────────┘
         │                                              │
         │ (4) Requêtes SQL                             │ (5) Requêtes SQL
         │     SELECT/INSERT/UPDATE                     │     CRUD complet
         ▼                                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    VLAN 30 - Base de Données                        │
│                    Serveur MariaDB 192.168.30.10                    │
│  ┌─────────────────────────┐  ┌─────────────────────────────────┐  │
│  │  DB: atlastech_web      │  │  DB: atlastech_rh               │  │
│  │  - Tables publiques     │  │  - Table employes (SENSIBLE)    │  │
│  │  - Aucune donnée RH     │  │  - Salaires (CONFIDENTIEL)      │  │
│  └─────────────────────────┘  └─────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
```

### Description des Flux

**Flux (1) : Accès Client au Site Commercial**
- **Source** : Internet public
- **Destination** : VLAN 10 (DMZ)
- **Protocole** : HTTPS (port 443)
- **Données échangées** : Pages web, formulaires de contact, demandes de devis
- **Sécurisation** : Pare-feu FortiGate + WAF, certificat SSL/TLS

**Flux (2) : Accès RH à l'Application Interne**
- **Source** : Postes de travail département RH (VLAN 20)
- **Destination** : Serveur CRUD RH (VLAN 20)
- **Protocole** : HTTPS (port 443)
- **Données échangées** : Données employés, documents RH
- **Sécurisation** : Restriction IP (192.168.20.0/24), authentification obligatoire

**Flux (3) : Communication Inter-Applications (LIMITÉE)**
- **Contexte** : Affichage de l'équipe sur le site commercial
- **Type** : API REST en lecture seule
- **Données exposées** : UNIQUEMENT prénom, nom, poste, photo (données publiques)
- **Données INTERDITES** : Salaire, CIN, adresse, email personnel, téléphone

**Implémentation du flux (3) :**

```php
// Fichier: /var/www/html/crud-rh/api/equipe_publique.php
<?php
// API read-only pour exposition publique limitée
header('Content-Type: application/json');
header('Access-Control-Allow-Origin: https://www.atlastech.ma');

// Authentification par clé API
$api_key = $_SERVER['HTTP_X_API_KEY'] ?? '';
$valid_api_key = hash('sha256', 'SECRET_KEY_COMPLEX_2024');

if (!hash_equals($valid_api_key, hash('sha256', $api_key))) {
    http_response_code(401);
    echo json_encode(['error' => 'Unauthorized']);
    exit;
}

// Connexion base de données
require_once '../config/database.php';

// IMPORTANT : Sélection UNIQUEMENT des champs non sensibles
$sql = "SELECT 
            prenom, 
            nom, 
            p.titre_poste AS poste,
            photo_url
        FROM employes e
        JOIN postes p ON e.poste_id = p.id
        WHERE e.statut = 'actif' 
          AND e.afficher_site_web = 1
        ORDER BY e.ordre_affichage";

$stmt = $pdo->prepare($sql);
$stmt->execute();
$equipe = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Masquage du chemin complet des photos (sécurité)
foreach ($equipe as &$membre) {
    $membre['photo_url'] = '/images/equipe/' . basename($membre['photo_url']);
}

echo json_encode([
    'success' => true,
    'data' => $equipe,
    'total' => count($equipe)
]);
```

**Consommation de l'API depuis le site commercial :**

```javascript
// Fichier: /var/www/html/atlastech-commercial/js/equipe.js
async function chargerEquipe() {
    try {
        const response = await fetch('https://rh-interne.atlastech.local/api/equipe_publique.php', {
            method: 'GET',
            headers: {
                'X-API-Key': 'CLE_API_SECRETE_ICI'
            }
        });
        
        if (!response.ok) {
            throw new Error('Erreur de chargement de l\'équipe');
        }
        
        const data = await response.json();
        
        // Affichage des membres de l'équipe
        const equipeContainer = document.getElementById('equipe-container');
        data.data.forEach(membre => {
            const card = `
                <div class="team-member-card">
                    <img src="${escapeHtml(membre.photo_url)}" alt="${escapeHtml(membre.prenom + ' ' + membre.nom)}">
                    <h3>${escapeHtml(membre.prenom + ' ' + membre.nom)}</h3>
                    <p>${escapeHtml(membre.poste)}</p>
                </div>
            `;
            equipeContainer.innerHTML += card;
        });
        
    } catch (error) {
        console.error('Erreur:', error);
    }
}

// Fonction d'échappement XSS (voir section 15.3)
function escapeHtml(unsafe) {
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}
```

**Flux (4) et (5) : Accès Base de Données**

Chaque application possède son propre utilisateur MySQL avec des privilèges spécifiques :

```sql
-- Utilisateur pour le site commercial (privilèges limités)
CREATE USER 'webapp_commercial'@'192.168.10.10' 
    IDENTIFIED BY 'MOT_DE_PASSE_FORT_ALEATOIRE';

GRANT SELECT, INSERT, UPDATE ON atlastech_web.* 
    TO 'webapp_commercial'@'192.168.10.10';

-- Pas d'accès DELETE (protection contre suppression accidentelle)
-- Pas d'accès à atlastech_rh (isolation totale)

-- Utilisateur pour l'application RH (privilèges complets sur sa base)
CREATE USER 'webapp_rh'@'192.168.20.10' 
    IDENTIFIED BY 'AUTRE_MOT_DE_PASSE_FORT_ALEATOIRE';

GRANT ALL PRIVILEGES ON atlastech_rh.* 
    TO 'webapp_rh'@'192.168.20.10';

-- Pas d'accès à atlastech_web (isolation totale)
```

**Vérification de l'isolation :**

```bash
# Test depuis le serveur commercial (192.168.10.10)
mysql -u webapp_commercial -p -h 192.168.30.10

# Tentative d'accès à la base RH (DOIT ÉCHOUER)
USE atlastech_rh;

# Résultat attendu :
ERROR 1044 (42000): Access denied for user 'webapp_commercial'@'192.168.10.10' 
to database 'atlastech_rh'

# Tentative de suppression dans sa propre base (DOIT ÉCHOUER)
DELETE FROM atlastech_web.clients WHERE id = 1;

# Résultat attendu :
ERROR 1142 (42000): DELETE command denied to user 'webapp_commercial'@'192.168.10.10' 
for table 'clients'
```

---

## Résumé et Points Clés

### Architecture Applicative AtlasTech Solutions

**Deux applications distinctes :**

| Critère | Site Commercial | Application CRUD RH |
|---------|----------------|---------------------|
| **Localisation** | VLAN 10 (DMZ) - 192.168.10.10 | VLAN 20 (Interne) - 192.168.20.10 |
| **Accessibilité** | Internet public | Réseau interne uniquement |
| **Technologies** | Apache + PHP 8.1 + MariaDB | Apache + PHP 8.1 + MariaDB |
| **Base de données** | atlastech_web | atlastech_rh |
| **Utilisateurs** | Clients, prospects | Département RH (3 personnes) |
| **Données** | Publiques (services, portfolio) | Confidentielles (salaires, RH) |
| **Niveau de sécurité** | Élevé (exposition Internet) | Critique (données personnelles) |

### Principes de Sécurité Appliqués

1. **Séparation des environnements** : DMZ vs Réseau Interne
2. **Isolation des données** : Bases séparées avec utilisateurs distincts
3. **Principe du moindre privilège** : Chaque application a les permissions minimales
4. **Défense en profondeur** : Pare-feu réseau + WAF + restrictions IP + authentification
5. **Limitation de la surface d'attaque** : API exposée uniquement pour données publiques

---

## Références Normatives

**OWASP (Open Web Application Security Project) :**
- OWASP Top 10 2021 : https://owasp.org/Top10/
- OWASP Application Security Verification Standard (ASVS) v4.0

**ISO/IEC 27001:2013 :**
- Annexe A.9 : Contrôle d'accès
- Annexe A.14 : Sécurité des systèmes d'information

**RGPD (Règlement Général sur la Protection des Données) :**
- Article 5 : Principes relatifs au traitement des données
- Article 25 : Protection des données dès la conception (Privacy by Design)
- Article 32 : Sécurité du traitement

**ANSSI (Agence Nationale de la Sécurité des Systèmes d'Information) :**
- Guide d'hygiène informatique : https://www.ssi.gouv.fr/
- Recommandations de sécurité relatives aux applications web

---

:::tip Prochaine Section
La section **15.2 Prévention des Injections SQL** détaillera les vulnérabilités liées aux requêtes SQL mal sécurisées et les techniques de protection par requêtes préparées (PDO Prepared Statements).
:::