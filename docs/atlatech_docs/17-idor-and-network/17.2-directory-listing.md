---
title: Directory Listing
sidebar_label: "17.2 Directory Listing"
sidebar_position: 2
---

# 17.2 Directory Listing

## Introduction

Le Directory Listing est une fonctionnalité Apache qui affiche automatiquement le contenu d'un répertoire lorsqu'aucun fichier index n'est présent. Cela représente une fuite d'information critique.

### Qu'est-ce que le Directory Listing ?

**Pour les non-techniciens :** Imaginez que vous laissez la porte de votre bureau ouverte avec tous vos dossiers visibles depuis le couloir. Le Directory Listing fait exactement cela avec vos fichiers web.

**Pour les techniciens :** Quand Apache reçoit une requête vers un répertoire sans index.html/index.php, il génère automatiquement une page HTML listant tous les fichiers présents.

---

## 17.2.1 État AVANT (Vulnérable)

### Test de Directory Listing

**Commande de test :**

```bash
# Créer un répertoire de test sans index
sudo mkdir -p /var/www/html/atlastech/test-dir
sudo touch /var/www/html/atlastech/test-dir/fichier_confidentiel.pdf
sudo touch /var/www/html/atlastech/test-dir/backup_db.sql
sudo touch /var/www/html/atlastech/test-dir/config_prod.php

# Tester l'accès
curl http://192.168.112.141/atlastech/test-dir/
```

**Résultat AVANT (Directory Listing activé) :**

```html
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head><title>Index of /atlastech/test-dir</title></head>
<body>
<h1>Index of /atlastech/test-dir</h1>
<table>
<tr><th>Name</th><th>Last modified</th><th>Size</th></tr>
<tr><td><a href="backup_db.sql">backup_db.sql</a></td><td>2026-02-10 08:15</td><td>2.5M</td></tr>
<tr><td><a href="config_prod.php">config_prod.php</a></td><td>2026-02-10 08:15</td><td>1.2K</td></tr>
<tr><td><a href="fichier_confidentiel.pdf">fichier_confidentiel.pdf</a></td><td>2026-02-10 08:15</td><td>456K</td></tr>
</table>
</body>
</html>
```

**Problème identifié :**
- Tous les fichiers sont visibles
- Un attaquant peut voir la structure des répertoires
- Fichiers de backup et configuration exposés

---

## 17.2.2 État APRÈS (Sécurisé)

### Solution 1 : Désactivation globale dans Apache

**Fichier de configuration Apache principal :**

```bash
sudo nano /etc/apache2/apache2.conf
```

**Modifier la section Directory :**

```apache
<Directory /var/www/html>
    Options -Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>
```

**Explication des options :**
- `-Indexes` : Désactive le listage automatique des répertoires
- `+FollowSymLinks` : Autorise les liens symboliques (fonctionnalité nécessaire)

### Solution 2 : Configuration spécifique AtlasTech

**Créer le fichier de configuration dédié :**

```bash
sudo nano /etc/apache2/sites-available/atlastech-security.conf
```

**Contenu :**

```apache
<VirtualHost *:80>
    ServerName atlastech.local
    DocumentRoot /var/www/html/atlastech
    
    <Directory /var/www/html/atlastech>
        Options -Indexes -MultiViews +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Protection supplémentaire
        <FilesMatch "\.(bak|sql|log|conf|ini)$">
            Require all denied
        </FilesMatch>
    </Directory>
    
    # Logs dédiés
    ErrorLog ${APACHE_LOG_DIR}/atlastech_error.log
    CustomLog ${APACHE_LOG_DIR}/atlastech_access.log combined
</VirtualHost>
```

**Activation de la configuration :**

```bash
sudo a2ensite atlastech-security.conf
sudo systemctl reload apache2
```

### Solution 3 : Fichier .htaccess (protection par répertoire)

**Créer .htaccess dans chaque répertoire sensible :**

```bash
sudo nano /var/www/html/atlastech/.htaccess
```

**Contenu :**

```apache
# Désactiver Directory Listing
Options -Indexes

# Bloquer l'accès aux fichiers sensibles
<FilesMatch "\.(sql|bak|backup|log|old|txt|conf|ini|sh)$">
    Require all denied
</FilesMatch>

# Bloquer l'accès aux fichiers cachés
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Page d'erreur personnalisée
ErrorDocument 403 /error_403.php
ErrorDocument 404 /error_404.php
```

---

## 17.2.3 Vérification de la correction

**Test 1 : Accès au répertoire sans index**

```bash
# Test après désactivation
curl -I http://192.168.112.141/atlastech/test-dir/
```

**Résultat attendu :**

```
HTTP/1.1 403 Forbidden
Date: Mon, 10 Feb 2026 09:30:00 GMT
Server: Apache/2.4.52 (Ubuntu)
Content-Type: text/html; charset=iso-8859-1
```

**Test 2 : Vérification complète avec nmap**

```bash
# Scanner les répertoires exposés
nikto -h http://192.168.112.141/atlastech/
```

**Résultat APRÈS correction :**

```
+ Server: Apache/2.4.52 (Ubuntu)
+ No CGI Directories found
- Directory indexing is disabled
+ OSVDB-3268: /atlastech/test-dir/: Directory indexing found.
  FAILED - Expected 403, got 403 (GOOD)
```

---

## 17.2.4 Protection des répertoires sensibles

**Liste des répertoires à protéger dans AtlasTech :**

```bash
# Créer des fichiers .htaccess dans tous les répertoires sensibles
for dir in uploads logs backups config tests; do
    if [ -d "/var/www/html/atlastech/$dir" ]; then
        sudo tee /var/www/html/atlastech/$dir/.htaccess > /dev/null <<EOF
Options -Indexes
Require all denied
EOF
        sudo chown www-data:www-data /var/www/html/atlastech/$dir/.htaccess
    fi
done
```

**Vérification :**

```bash
find /var/www/html/atlastech -name .htaccess -exec ls -l {} \;
```

**Résultat attendu :**

```
-rw-r--r-- 1 www-data www-data 45 Feb 10 09:35 /var/www/html/atlastech/.htaccess
-rw-r--r-- 1 www-data www-data 45 Feb 10 09:35 /var/www/html/atlastech/uploads/.htaccess
-rw-r--r-- 1 www-data www-data 45 Feb 10 09:35 /var/www/html/atlastech/logs/.htaccess
```

---

## 17.2.5 Page d'erreur personnalisée

**Créer une page 403 professionnelle :**

```bash
sudo nano /var/www/html/atlastech/error_403.php
```

**Contenu :**

```php
<?php
http_response_code(403);
header('Content-Type: text/html; charset=UTF-8');
?>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accès Interdit - AtlasTech Solutions</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        .error-container {
            background: white;
            padding: 50px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 500px;
        }
        h1 {
            color: #e74c3c;
            font-size: 4em;
            margin: 0;
        }
        h2 {
            color: #2c3e50;
            font-size: 1.5em;
        }
        p {
            color: #7f8c8d;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <h1>403</h1>
        <h2>Accès Interdit</h2>
        <p>Vous n'avez pas les permissions nécessaires pour accéder à cette ressource.</p>
        <p>Si vous pensez qu'il s'agit d'une erreur, veuillez contacter l'administrateur système.</p>
        <a href="/" style="display: inline-block; margin-top: 20px; padding: 12px 30px; background: #667eea; color: white; text-decoration: none; border-radius: 8px;">Retour à l'accueil</a>
    </div>
</body>
</html>
```

---

## 17.2.6 Audit automatique

**Script de vérification quotidien :**

```bash
sudo nano /usr/local/bin/check_directory_listing.sh
```

**Contenu du script :**

```bash
#!/bin/bash
# Vérification Directory Listing - AtlasTech

LOG_FILE="/var/log/atlastech/directory_listing_check.log"
mkdir -p /var/log/atlastech

echo "[$(date)] Démarrage vérification Directory Listing" >> $LOG_FILE

# Liste des répertoires à vérifier
DIRS=(
    "/var/www/html/atlastech"
    "/var/www/html/atlastech/uploads"
    "/var/www/html/atlastech/logs"
)

for DIR in "${DIRS[@]}"; do
    if [ -d "$DIR" ]; then
        # Vérifier si .htaccess existe
        if [ ! -f "$DIR/.htaccess" ]; then
            echo "[ALERT] .htaccess manquant dans $DIR" >> $LOG_FILE
            # Créer automatiquement
            echo "Options -Indexes" > "$DIR/.htaccess"
            chown www-data:www-data "$DIR/.htaccess"
        fi
    fi
done

# Vérifier la configuration Apache
if grep -q "Options.*Indexes" /etc/apache2/apache2.conf; then
    echo "[WARNING] Options Indexes encore présent dans apache2.conf" >> $LOG_FILE
fi

echo "[$(date)] Vérification terminée" >> $LOG_FILE
```

**Rendre exécutable et ajouter au cron :**

```bash
sudo chmod +x /usr/local/bin/check_directory_listing.sh

# Ajouter au crontab (quotidien à 3h)
(sudo crontab -l 2>/dev/null; echo "0 3 * * * /usr/local/bin/check_directory_listing.sh") | sudo crontab -
```

---

## 17.2.7 Tableau récapitulatif

| Aspect | Avant | Après |
|--------|-------|-------|
| **Listage répertoires** | Activé | Désactivé |
| **Fichiers sensibles visibles** | Oui | Non |
| **Page d'erreur** | Apache par défaut | Personnalisée |
| **Protection .htaccess** | Absente | Présente dans tous les répertoires |
| **Audit automatique** | Non | Quotidien |

---

## Conclusion

Directory Listing désactivé pour AtlasTech :

**Protections implémentées :**
- Options -Indexes dans apache2.conf
- Fichiers .htaccess dans tous les répertoires sensibles
- Blocage des extensions dangereuses (.sql, .bak, .log)
- Page 403 personnalisée
- Script d'audit quotidien

**Conformité :**
- CIS Apache Benchmark 5.7 : Conforme
- OWASP ASVS V14.5.2 : Conforme

**Prochaine section :** 17.3 URL Rewriting